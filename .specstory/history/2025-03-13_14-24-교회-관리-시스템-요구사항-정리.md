## SpecStory

## 교회 관리 시스템 요구사항 정리 (2025. 3. 13. 오후 2:24:51)

_**User**_

서버 실행에 대한 내용은 제외하고 알려주고 서버를 재시작해야하는 경우는 그냥 알려주기만 해.
이제 회원이 로그인한 이후에 대한 로직을 설명할게.
회원은 로그인하고 나면 우선 관리하고 있는 교회의 리스트를 출력하고 교회를 생성하고 삭제할 수 있는 갤러리형 게시판 형태의 리스트 페이지로 이동할거야.
거기서 교회를 생성하는 페이즈로 이동하면 교회 구분값, 교회 이름과 주소, 연락처 정보를 입력하는 페이지로 이동할거야.
이 때 구분값은 중복되지 않아야 하고 구분값과 교회 이름은 필수값이고 나머지는 생략이 가능해. 그리고 교회 구분값은 영문으로 입력해야 해.
중복 검사를 해야겠지. 중복 검사는 구분값을 입력하면 그 구분값이 이미 존재하는지 검사하는 로직을 만들어야겠지.
교회가 생성되고 나면 해당 교회를 클릭하고 교회 페이지로 이동하고 교회 페이지에서는 주보 리스트와 템플릿(background 등을 꾸밀 수 있는 기능) 관리, 교회 정보 관리 등의 세부 페이지를 선택할 수 있도록 할거야.
교회 정보 관리에서는 교회 이름과 주소, 연락처 정보를 수정할 수 있고 교회 삭제 기능도 있어.
주보를 게시판형으로 출력되도록 하고 제목줄은 날짜 정보를 출력하도록 할거야.
일단 여기까지만 진행해볼게.

설치가 필요한 패키지가 있으면 추가로 설치해줘도 돼.

---

_**Assistant**_

# 교회 관리 시스템 구현 계획

안녕하세요! 교회 관리 시스템에 대한 요구사항을 분석해 보겠습니다. 로그인 이후의 기능들을 구현하기 위해 필요한 내용을 정리해 드리겠습니다.

## 필요한 패키지

```
pip install fastapi sqlalchemy pydantic python-jose[cryptography] passlib[bcrypt] python-multipart
```

## 데이터베이스 모델 설계

먼저 교회 정보를 저장할 모델을 만들어야 합니다:

```python:app/models/church.py
from sqlalchemy import Column, Integer, String, ForeignKey
from sqlalchemy.orm import relationship

from app.database import Base

class Church(Base):
    __tablename__ = "churches"
    
    id = Column(Integer, primary_key=True, index=True)
    code = Column(String, unique=True, index=True)  # 교회 구분값 (영문, 중복 불가)
    name = Column(String, nullable=False)  # 교회 이름 (필수)
    address = Column(String, nullable=True)  # 주소 (선택)
    contact = Column(String, nullable=True)  # 연락처 (선택)
    user_id = Column(Integer, ForeignKey("users.id"))
    
    # 관계 설정
    user = relationship("User", back_populates="churches")
    bulletins = relationship("Bulletin", back_populates="church", cascade="all, delete-orphan")
    templates = relationship("Template", back_populates="church", cascade="all, delete-orphan")
```

```python:app/models/bulletin.py
from sqlalchemy import Column, Integer, String, Date, ForeignKey
from sqlalchemy.orm import relationship
from datetime import date

from app.database import Base

class Bulletin(Base):
    __tablename__ = "bulletins"
    
    id = Column(Integer, primary_key=True, index=True)
    title = Column(String, nullable=False)
    content = Column(String, nullable=True)
    date = Column(Date, default=date.today)
    church_id = Column(Integer, ForeignKey("churches.id"))
    
    church = relationship("Church", back_populates="bulletins")
```

```python:app/models/template.py
from sqlalchemy import Column, Integer, String, ForeignKey
from sqlalchemy.orm import relationship

from app.database import Base

class Template(Base):
    __tablename__ = "templates"
    
    id = Column(Integer, primary_key=True, index=True)
    name = Column(String, nullable=False)
    background_url = Column(String, nullable=True)
    style_data = Column(String, nullable=True)  # JSON 형태로 스타일 정보 저장
    church_id = Column(Integer, ForeignKey("churches.id"))
    
    church = relationship("Church", back_populates="templates")
```

기존 User 모델에 교회와의 관계를 추가해야 합니다:

```python:app/models/user.py
# ... 기존 코드 ...
from sqlalchemy.orm import relationship

class User(Base):
    # ... 기존 코드 ...
    
    churches = relationship("Church", back_populates="user")
```

## 스키마 정의

```python:app/schemas/church.py
from typing import Optional, List
from pydantic import BaseModel, validator
import re

class ChurchBase(BaseModel):
    code: str
    name: str
    address: Optional[str] = None
    contact: Optional[str] = None
    
    @validator('code')
    def code_must_be_english(cls, v):
        if not re.match(r'^[a-zA-Z0-9_-]+$', v):
            raise ValueError('교회 구분값은 영문, 숫자, 하이픈, 언더스코어만 사용 가능합니다')
        return v

class ChurchCreate(ChurchBase):
    pass

class ChurchUpdate(BaseModel):
    name: Optional[str] = None
    address: Optional[str] = None
    contact: Optional[str] = None

class Church(ChurchBase):
    id: int
    user_id: int
    
    class Config:
        orm_mode = True
```

```python:app/schemas/bulletin.py
from typing import Optional
from pydantic import BaseModel
from datetime import date

class BulletinBase(BaseModel):
    title: str
    content: Optional[str] = None
    date: date

class BulletinCreate(BulletinBase):
    pass

class BulletinUpdate(BaseModel):
    title: Optional[str] = None
    content: Optional[str] = None
    date: Optional[date] = None

class Bulletin(BulletinBase):
    id: int
    church_id: int
    
    class Config:
        orm_mode = True
```

## API 라우트 구현

### 교회 관리 라우트

```python:app/routers/churches.py
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from typing import List

from app import crud, schemas, models
from app.dependencies import get_db, get_current_user

router = APIRouter(
    prefix="/churches",
    tags=["churches"],
    dependencies=[Depends(get_current_user)]
)

@router.get("/", response_model=List[schemas.Church])
def read_churches(
    skip: int = 0, 
    limit: int = 100, 
    db: Session = Depends(get_db),
    current_user: models.User = Depends(get_current_user)
):
    """현재 로그인한 사용자의 교회 목록을 반환합니다."""
    return crud.get_user_churches(db, user_id=current_user.id, skip=skip, limit=limit)

@router.post("/", response_model=schemas.Church)
def create_church(
    church: schemas.ChurchCreate, 
    db: Session = Depends(get_db),
    current_user: models.User = Depends(get_current_user)
):
    """새 교회를 생성합니다."""
    # 교회 코드 중복 확인
    db_church = crud.get_church_by_code(db, code=church.code)
    if db_church:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail="이미 사용 중인 교회 구분값입니다"
        )
    return crud.create_church(db=db, church=church, user_id=current_user.id)

@router.get("/check-code/{code}")
def check_church_code(code: str, db: Session = Depends(get_db)):
    """교회 구분값 중복 확인"""
    db_church = crud.get_church_by_code(db, code=code)
    return {"available": db_church is None}

@router.get("/{church_id}", response_model=schemas.Church)
def read_church(
    church_id: int, 
    db: Session = Depends(get_db),
    current_user: models.User = Depends(get_current_user)
):
    """특정 교회 정보를 반환합니다."""
    db_church = crud.get_church(db, church_id=church_id)
    if db_church is None:
        raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
    if db_church.user_id != current_user.id:
        raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
    return db_church

@router.put("/{church_id}", response_model=schemas.Church)
def update_church(
    church_id: int, 
    church: schemas.ChurchUpdate, 
    db: Session = Depends(get_db),
    current_user: models.User = Depends(get_current_user)
):
    """교회 정보를 수정합니다."""
    db_church = crud.get_church(db, church_id=church_id)
    if db_church is None:
        raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
    if db_church.user_id != current_user.id:
        raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
    return crud.update_church(db=db, church_id=church_id, church=church)

@router.delete("/{church_id}")
def delete_church(
    church_id: int, 
    db: Session = Depends(get_db),
    current_user: models.User = Depends(get_current_user)
):
    """교회를 삭제합니다."""
    db_church = crud.get_church(db, church_id=church_id)
    if db_church is None:
        raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
    if db_church.user_id != current_user.id:
        raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
    crud.delete_church(db=db, church_id=church_id)
    return {"detail": "교회가 삭제되었습니다"}
```

### 주보 관리 라우트

```python:app/routers/bulletins.py
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from typing import List

from app import crud, schemas, models
from app.dependencies import get_db, get_current_user

router = APIRouter(
    prefix="/churches/{church_id}/bulletins",
    tags=["bulletins"],
    dependencies=[Depends(get_current_user)]
)

@router.get("/", response_model=List[schemas.Bulletin])
def read_bulletins(
    church_id: int,
    skip: int = 0, 
    limit: int = 100, 
    db: Session = Depends(get_db),
    current_user: models.User = Depends(get_current_user)
):
    """특정 교회의 주보 목록을 반환합니다."""
    # 교회 소유권 확인
    db_church = crud.get_church(db, church_id=church_id)
    if db_church is None:
        raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
    if db_church.user_id != current_user.id:
        raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
    
    return crud.get_church_bulletins(db, church_id=church_id, skip=skip, limit=limit)

@router.post("/", response_model=schemas.Bulletin)
def create_bulletin(
    church_id: int,
    bulletin: schemas.BulletinCreate, 
    db: Session = Depends(get_db),
    current_user: models.User = Depends(get_current_user)
):
    """새 주보를 생성합니다."""
    # 교회 소유권 확인
    db_church = crud.get_church(db, church_id=church_id)
    if db_church is None:
        raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
    if db_church.user_id != current_user.id:
        raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
    
    return crud.create_bulletin(db=db, bulletin=bulletin, church_id=church_id)
```

## CRUD 함수 구현

```python:app/crud/church.py
from sqlalchemy.orm import Session
from app import models, schemas

def get_church(db: Session, church_id: int):
    return db.query(models.Church).filter(models.Church.id == church_id).first()

def get_church_by_code(db: Session, code: str):
    return db.query(models.Church).filter(models.Church.code == code).first()

def get_user_churches(db: Session, user_id: int, skip: int = 0, limit: int = 100):
    return db.query(models.Church).filter(models.Church.user_id == user_id).offset(skip).limit(limit).all()

def create_church(db: Session, church: schemas.ChurchCreate, user_id: int):
    db_church = models.Church(
        code=church.code,
        name=church.name,
        address=church.address,
        contact=church.contact,
        user_id=user_id
    )
    db.add(db_church)
    db.commit()
    db.refresh(db_church)
    return db_church

def update_church(db: Session, church_id: int, church: schemas.ChurchUpdate):
    db_church = get_church(db, church_id=church_id)
    
    update_data = church.dict(exclude_unset=True)
    for key, value in update_data.items():
        setattr(db_church, key, value)
    
    db.commit()
    db.refresh(db_church)
    return db_church

def delete_church(db: Session, church_id: int):
    db_church = get_church(db, church_id=church_id)
    db.delete(db_church)
    db.commit()
    return db_church
```

```python:app/crud/bulletin.py
from sqlalchemy.orm import Session
from app import models, schemas

def get_bulletin(db: Session, bulletin_id: int):
    return db.query(models.Bulletin).filter(models.Bulletin.id == bulletin_id).first()

def get_church_bulletins(db: Session, church_id: int, skip: int = 0, limit: int = 100):
    return db.query(models.Bulletin).filter(models.Bulletin.church_id == church_id).offset(skip).limit(limit).all()

def create_bulletin(db: Session, bulletin: schemas.BulletinCreate, church_id: int):
    db_bulletin = models.Bulletin(
        title=bulletin.title,
        content=bulletin.content,
        date=bulletin.date,
        church_id=church_id
    )
    db.add(db_bulletin)
    db.commit()
    db.refresh(db_bulletin)
    return db_bulletin
```

## 메인 애플리케이션에 라우터 등록

```python:app/main.py
# ... 기존 코드 ...
from app.routers import users, churches, bulletins

# ... 기존 코드 ...

app.include_router(users.router)
app.include_router(churches.router)
app.include_router(bulletins.router)
```

## 프론트엔드 구현 (React 예시)

교회 목록 페이지, 교회 생성 페이지, 교회 상세 페이지, 주보 목록 페이지 등의 프론트엔드 구현이 필요합니다. 이는 React나 다른 프론트엔드 프레임워크를 사용하여 구현할 수 있습니다.

## 구현 후 해야 할 일

1. 데이터베이스 마이그레이션 실행
2. 서버 재시작 필요

이 구현을 통해 사용자는 로그인 후 자신이 관리하는 교회 목록을 볼 수 있고, 새 교회를 생성하거나 기존 교회를 관리할 수 있습니다. 교회 페이지에서는 주보 목록을 확인하고 관리할 수 있습니다.

---

_**User**_

이 내용을 현재 프로젝트를 확인하고 적용해줘./

---

_**Assistant**_

현재 프로젝트를 확인하고 요구사항에 맞게 구현해 드리겠습니다. 먼저 프로젝트 구조를 파악하겠습니다.

---

_****_

<details>
            <summary>Listed directory app • **11** results</summary>
        
| Name |
|-------|
| 📁 `__pycache__` |
| 📄 `main.py` |
| 📄 `deps.py` |
| 📁 `services` |
| 📁 `schemas` |
| 📁 `models` |
| 📁 `db` |
| 📁 `utils` |
| 📁 `routers` |
| 📁 `api` |
| 📁 `core` |

</details>

---

_****_

<details>
            <summary>Listed directory app/routers • **4** results</summary>
        
| Name |
|-------|
| 📁 `__pycache__` |
| 📄 `auth.py` |
| 📄 `users.py` |
| 📄 `__init__.py` |

</details>

---

_****_

Read file: undefined

---

_****_

<details>
            <summary>Listed directory app/schemas • **3** results</summary>
        
| Name |
|-------|
| 📁 `__pycache__` |
| 📄 `user.py` |
| 📄 `__init__.py` |

</details>

---

_****_

이제 요구사항에 맞게 교회 관리 기능을 구현하겠습니다. 먼저 필요한 스키마를 만들겠습니다.

---

_****_

```diff
  # 스키마 패키지 초기화 파일
  # 여기서는 라우터를 직접 가져오지 않습니다.
+ 
+ from app.schemas.user import User, UserCreate, UserUpdate, UserInDB, Token, TokenPayload
+ from app.schemas.church import Church, ChurchCreate, ChurchUpdate, ChurchCheck
+ from app.schemas.bulletin import Bulletin, BulletinCreate, BulletinUpdate, BulletinTemplate, BulletinTemplateCreate, BulletinTemplateUpdate
  
```

---

_****_

```diff
  from app.schemas.church import Church, ChurchCreate, ChurchUpdate, ChurchCheck
  from app.schemas.bulletin import Bulletin, BulletinCreate, BulletinUpdate, BulletinTemplate, BulletinTemplateCreate, BulletinTemplateUpdate
+ 
+ __all__ = [
+     "User", "UserCreate", "UserUpdate", "UserInDB", "Token", "TokenPayload",
+     "Church", "ChurchCreate", "ChurchUpdate", "ChurchCheck",
+     "Bulletin", "BulletinCreate", "BulletinUpdate",
+     "BulletinTemplate", "BulletinTemplateCreate", "BulletinTemplateUpdate"
+ ]
  
```

---

_****_

이제 교회 스키마를 생성하겠습니다.

---

_****_

```diff
- 
+ from typing import Optional, List
+ from pydantic import BaseModel, validator
+ import re
+ from datetime import datetime
+ 
+ 
+ class ChurchBase(BaseModel):
+     """교회 기본 스키마"""
+     name: str
+     address: Optional[str] = None
+     contact_info: Optional[str] = None
+ 
+ 
+ class ChurchCreate(ChurchBase):
+     """교회 생성 스키마"""
+     church_code: str
+ 
+     @validator('church_code')
+     def church_code_must_be_english(cls, v):
+         if not re.match(r'^[a-zA-Z0-9_-]+$', v):
+             raise ValueError('교회 구분값은 영문, 숫자, 하이픈, 언더스코어만 사용 가능합니다')
+         return v
+ 
+ 
+ class ChurchUpdate(BaseModel):
+     """교회 업데이트 스키마"""
+     name: Optional[str] = None
+     address: Optional[str] = None
+     contact_info: Optional[str] = None
+ 
+ 
+ class ChurchCheck(BaseModel):
+     """교회 코드 중복 확인 응답 스키마"""
+     available: bool
+     message: Optional[str] = None
+ 
+ 
+ class Church(ChurchBase):
+     """교회 응답 스키마"""
+     id: int
+     church_code: str
+     created_at: datetime
+     updated_at: Optional[datetime] = None
+     is_deleted: bool
+ 
+     class Config:
+         orm_mode = True
```

---

_****_

```diff
- from typing import Optional, List
+ from typing import Optional
  from pydantic import BaseModel, validator
  import re
```

---

_****_

이제 주보 관련 스키마를 생성하겠습니다.

---

_****_

```diff
- 
+ from typing import Optional, Dict, Any
+ from pydantic import BaseModel
+ from datetime import datetime, date
+ 
+ 
+ class BulletinTemplateBase(BaseModel):
+     """주보 템플릿 기본 스키마"""
+     name: str
+     template_data: Dict[str, Any]
+ 
+ 
+ class BulletinTemplateCreate(BulletinTemplateBase):
+     """주보 템플릿 생성 스키마"""
+     pass
+ 
+ 
+ class BulletinTemplateUpdate(BaseModel):
+     """주보 템플릿 업데이트 스키마"""
+     name: Optional[str] = None
+     template_data: Optional[Dict[str, Any]] = None
+ 
+ 
+ class BulletinTemplate(BulletinTemplateBase):
+     """주보 템플릿 응답 스키마"""
+     id: int
+     church_id: int
+     created_at: datetime
+     updated_at: Optional[datetime] = None
+     is_deleted: bool
+ 
+     class Config:
+         orm_mode = True
+ 
+ 
+ class BulletinBase(BaseModel):
+     """주보 기본 스키마"""
+     date: date
+     content: Dict[str, Any]
+     template_id: int
+ 
+ 
+ class BulletinCreate(BulletinBase):
+     """주보 생성 스키마"""
+     pass
+ 
+ 
+ class BulletinUpdate(BaseModel):
+     """주보 업데이트 스키마"""
+     date: Optional[date] = None
+     content: Optional[Dict[str, Any]] = None
+     template_id: Optional[int] = None
+ 
+ 
+ class Bulletin(BulletinBase):
+     """주보 응답 스키마"""
+     id: int
+     church_id: int
+     created_at: datetime
+     updated_at: Optional[datetime] = None
+     is_deleted: bool
+ 
+     class Config:
+         orm_mode = True
```

---

_****_

이제 User 모델에 교회 관리자 관계를 추가하겠습니다.

---

_****_

Read file: undefined

---

_****_

```diff
  from sqlalchemy import Boolean, Column, Integer, String, DateTime
  from sqlalchemy.sql import func
+ from sqlalchemy.orm import relationship
  
  from app.db.base_class import Base
  
      # Relationships
-     # church_admin_roles = relationship("ChurchAdmin", back_populates="user")
+     church_admin_roles = relationship("ChurchAdmin", back_populates="user")
  
```

---

_****_

이제 교회 관련 라우터를 생성하겠습니다.

---

_****_

```diff
- 
+ from fastapi import APIRouter, Depends, HTTPException, status
+ from sqlalchemy.orm import Session
+ from typing import List
+ from datetime import datetime
+ 
+ from app import schemas
+ from app.models import Church, ChurchAdmin
+ from app.db.session import get_db
+ from app.routers.auth import get_current_active_user
+ from app.models.user import User
+ 
+ router = APIRouter()
+ 
+ 
+ @router.get("/", response_model=List[schemas.Church])
+ def read_churches(
+     skip: int = 0,
+     limit: int = 100,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """현재 로그인한 사용자가 관리하는 교회 목록을 반환합니다."""
+     # 사용자가 관리하는 교회 ID 목록 조회
+     church_ids = db.query(ChurchAdmin.church_id).filter(
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted == False
+     ).all()
+     church_ids = [church_id[0] for church_id in church_ids]
+ 
+     # 교회 목록 조회
+     churches = db.query(Church).filter(
+         Church.id.in_(church_ids),
+         Church.is_deleted == False
+     ).offset(skip).limit(limit).all()
+ 
+     return churches
+ 
+ 
+ @router.post("/", response_model=schemas.Church)
+ def create_church(
+     church: schemas.ChurchCreate,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """새 교회를 생성합니다."""
+     # 교회 코드 중복 확인
+     db_church = db.query(Church).filter(
+         Church.church_code == church.church_code,
+         Church.is_deleted == False
+     ).first()
+ 
+     if db_church:
+         raise HTTPException(
+             status_code=status.HTTP_400_BAD_REQUEST,
+             detail="이미 사용 중인 교회 구분값입니다"
+         )
+ 
+     # 교회 생성
+     new_church = Church(
+         church_code=church.church_code,
+         name=church.name,
+         address=church.address,
+         contact_info=church.contact_info
+     )
+     db.add(new_church)
+     db.flush()
+ 
+     # 교회 관리자 등록
+     church_admin = ChurchAdmin(
+         church_id=new_church.id,
+         user_id=current_user.id
+     )
+     db.add(church_admin)
+     db.commit()
+     db.refresh(new_church)
+ 
+     return new_church
+ 
+ 
+ @router.get("/check-code/{church_code}", response_model=schemas.ChurchCheck)
+ def check_church_code(church_code: str, db: Session = Depends(get_db)):
+     """교회 구분값 중복 확인"""
+     db_church = db.query(Church).filter(
+         Church.church_code == church_code,
+         Church.is_deleted == False
+     ).first()
+ 
+     if db_church:
+         return {"available": False, "message": "이미 사용 중인 교회 구분값입니다"}
+     return {"available": True, "message": "사용 가능한 교회 구분값입니다"}
+ 
+ 
+ @router.get("/{church_id}", response_model=schemas.Church)
+ def read_church(
+     church_id: int,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """특정 교회 정보를 반환합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted == False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted == False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     return db_church
+ 
+ 
+ @router.put("/{church_id}", response_model=schemas.Church)
+ def update_church(
+     church_id: int,
+     church: schemas.ChurchUpdate,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """교회 정보를 수정합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted == False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted == False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     # 교회 정보 업데이트
+     update_data = church.dict(exclude_unset=True)
+     for key, value in update_data.items():
+         setattr(db_church, key, value)
+ 
+     db.commit()
+     db.refresh(db_church)
+     return db_church
+ 
+ 
+ @router.delete("/{church_id}")
+ def delete_church(
+     church_id: int,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """교회를 삭제합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted == False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted == False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     # 교회 삭제 처리 (소프트 삭제)
+     db_church.is_deleted = True
+     db_church.deleted_at = datetime.now()
+     db.commit()
+ 
+     return {"detail": "교회가 삭제되었습니다"}
```

---

_****_

```diff
      church_ids = db.query(ChurchAdmin.church_id).filter(
          ChurchAdmin.user_id == current_user.id,
-         ChurchAdmin.is_deleted == False
+         ChurchAdmin.is_deleted is False
      ).all()
      church_ids = [church_id[0] for church_id in church_ids]
      churches = db.query(Church).filter(
          Church.id.in_(church_ids),
-         Church.is_deleted == False
+         Church.is_deleted is False
      ).offset(skip).limit(limit).all()
  
      db_church = db.query(Church).filter(
          Church.church_code == church.church_code,
-         Church.is_deleted == False
+         Church.is_deleted is False
      ).first()
  
      db_church = db.query(Church).filter(
          Church.church_code == church_code,
-         Church.is_deleted == False
+         Church.is_deleted is False
      ).first()
  
      db_church = db.query(Church).filter(
          Church.id == church_id,
-         Church.is_deleted == False
+         Church.is_deleted is False
      ).first()
  
          ChurchAdmin.church_id == church_id,
          ChurchAdmin.user_id == current_user.id,
-         ChurchAdmin.is_deleted == False
+         ChurchAdmin.is_deleted is False
      ).first()
  
      db_church = db.query(Church).filter(
          Church.id == church_id,
-         Church.is_deleted == False
+         Church.is_deleted is False
      ).first()
  
          ChurchAdmin.church_id == church_id,
          ChurchAdmin.user_id == current_user.id,
-         ChurchAdmin.is_deleted == False
+         ChurchAdmin.is_deleted is False
      ).first()
  
      db_church = db.query(Church).filter(
          Church.id == church_id,
-         Church.is_deleted == False
+         Church.is_deleted is False
      ).first()
  
          ChurchAdmin.church_id == church_id,
          ChurchAdmin.user_id == current_user.id,
-         ChurchAdmin.is_deleted == False
+         ChurchAdmin.is_deleted is False
      ).first()
  
```

---

_****_

이제 주보 관련 라우터를 생성하겠습니다.

---

_****_

```diff
- 
+ from fastapi import APIRouter, Depends, HTTPException, status
+ from sqlalchemy.orm import Session
+ from typing import List
+ from datetime import datetime
+ 
+ from app import schemas
+ from app.models import Church, ChurchAdmin, Bulletin, BulletinTemplate
+ from app.db.session import get_db
+ from app.routers.auth import get_current_active_user
+ from app.models.user import User
+ 
+ router = APIRouter()
+ 
+ 
+ @router.get("/{church_id}/bulletins", response_model=List[schemas.Bulletin])
+ def read_bulletins(
+     church_id: int,
+     skip: int = 0,
+     limit: int = 100,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """특정 교회의 주보 목록을 반환합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted is False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted is False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     # 주보 목록 조회
+     bulletins = db.query(Bulletin).filter(
+         Bulletin.church_id == church_id,
+         Bulletin.is_deleted is False
+     ).order_by(Bulletin.date.desc()).offset(skip).limit(limit).all()
+ 
+     return bulletins
+ 
+ 
+ @router.post("/{church_id}/bulletins", response_model=schemas.Bulletin)
+ def create_bulletin(
+     church_id: int,
+     bulletin: schemas.BulletinCreate,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """새 주보를 생성합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted is False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted is False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     # 템플릿 확인
+     template = db.query(BulletinTemplate).filter(
+         BulletinTemplate.id == bulletin.template_id,
+         BulletinTemplate.church_id == church_id,
+         BulletinTemplate.is_deleted is False
+     ).first()
+ 
+     if template is None:
+         raise HTTPException(status_code=404, detail="템플릿을 찾을 수 없습니다")
+ 
+     # 주보 생성
+     new_bulletin = Bulletin(
+         church_id=church_id,
+         template_id=bulletin.template_id,
+         date=bulletin.date,
+         content=bulletin.content
+     )
+     db.add(new_bulletin)
+     db.commit()
+     db.refresh(new_bulletin)
+ 
+     return new_bulletin
+ 
+ 
+ @router.get("/{church_id}/bulletins/{bulletin_id}", response_model=schemas.Bulletin)
+ def read_bulletin(
+     church_id: int,
+     bulletin_id: int,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """특정 주보 정보를 반환합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted is False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted is False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     # 주보 조회
+     bulletin = db.query(Bulletin).filter(
+         Bulletin.id == bulletin_id,
+         Bulletin.church_id == church_id,
+         Bulletin.is_deleted is False
+     ).first()
+ 
+     if bulletin is None:
+         raise HTTPException(status_code=404, detail="주보를 찾을 수 없습니다")
+ 
+     return bulletin
+ 
+ 
+ @router.put("/{church_id}/bulletins/{bulletin_id}", response_model=schemas.Bulletin)
+ def update_bulletin(
+     church_id: int,
+     bulletin_id: int,
+     bulletin_update: schemas.BulletinUpdate,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """주보 정보를 수정합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted is False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted is False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     # 주보 조회
+     bulletin = db.query(Bulletin).filter(
+         Bulletin.id == bulletin_id,
+         Bulletin.church_id == church_id,
+         Bulletin.is_deleted is False
+     ).first()
+ 
+     if bulletin is None:
+         raise HTTPException(status_code=404, detail="주보를 찾을 수 없습니다")
+ 
+     # 템플릿 변경 시 확인
+     if bulletin_update.template_id is not None:
+         template = db.query(BulletinTemplate).filter(
+             BulletinTemplate.id == bulletin_update.template_id,
+             BulletinTemplate.church_id == church_id,
+             BulletinTemplate.is_deleted is False
+         ).first()
+ 
+         if template is None:
+             raise HTTPException(status_code=404, detail="템플릿을 찾을 수 없습니다")
+ 
+     # 주보 정보 업데이트
+     update_data = bulletin_update.dict(exclude_unset=True)
+     for key, value in update_data.items():
+         setattr(bulletin, key, value)
+ 
+     db.commit()
+     db.refresh(bulletin)
+     return bulletin
+ 
+ 
+ @router.delete("/{church_id}/bulletins/{bulletin_id}")
+ def delete_bulletin(
+     church_id: int,
+     bulletin_id: int,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """주보를 삭제합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted is False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted is False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     # 주보 조회
+     bulletin = db.query(Bulletin).filter(
+         Bulletin.id == bulletin_id,
+         Bulletin.church_id == church_id,
+         Bulletin.is_deleted is False
+     ).first()
+ 
+     if bulletin is None:
+         raise HTTPException(status_code=404, detail="주보를 찾을 수 없습니다")
+ 
+     # 주보 삭제 처리 (소프트 삭제)
+     bulletin.is_deleted = True
+     bulletin.deleted_at = datetime.now()
+     db.commit()
+ 
+     return {"detail": "주보가 삭제되었습니다"}
```

---

_****_

```diff
- from fastapi import APIRouter, Depends, HTTPException, status
+ from fastapi import APIRouter, Depends, HTTPException
  from sqlalchemy.orm import Session
  from typing import List
```

---

_****_

이제 템플릿 관련 라우터를 생성하겠습니다.

---

_****_

```diff
- 
+ from fastapi import APIRouter, Depends, HTTPException
+ from sqlalchemy.orm import Session
+ from typing import List
+ from datetime import datetime
+ 
+ from app import schemas
+ from app.models import Church, ChurchAdmin, BulletinTemplate
+ from app.db.session import get_db
+ from app.routers.auth import get_current_active_user
+ from app.models.user import User
+ 
+ router = APIRouter()
+ 
+ 
+ @router.get("/{church_id}/templates", response_model=List[schemas.BulletinTemplate])
+ def read_templates(
+     church_id: int,
+     skip: int = 0,
+     limit: int = 100,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """특정 교회의 템플릿 목록을 반환합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted is False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted is False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     # 템플릿 목록 조회
+     templates = db.query(BulletinTemplate).filter(
+         BulletinTemplate.church_id == church_id,
+         BulletinTemplate.is_deleted is False
+     ).offset(skip).limit(limit).all()
+ 
+     return templates
+ 
+ 
+ @router.post("/{church_id}/templates", response_model=schemas.BulletinTemplate)
+ def create_template(
+     church_id: int,
+     template: schemas.BulletinTemplateCreate,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """새 템플릿을 생성합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted is False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted is False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     # 템플릿 생성
+     new_template = BulletinTemplate(
+         church_id=church_id,
+         name=template.name,
+         template_data=template.template_data
+     )
+     db.add(new_template)
+     db.commit()
+     db.refresh(new_template)
+ 
+     return new_template
+ 
+ 
+ @router.get("/{church_id}/templates/{template_id}", response_model=schemas.BulletinTemplate)
+ def read_template(
+     church_id: int,
+     template_id: int,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """특정 템플릿 정보를 반환합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted is False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted is False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     # 템플릿 조회
+     template = db.query(BulletinTemplate).filter(
+         BulletinTemplate.id == template_id,
+         BulletinTemplate.church_id == church_id,
+         BulletinTemplate.is_deleted is False
+     ).first()
+ 
+     if template is None:
+         raise HTTPException(status_code=404, detail="템플릿을 찾을 수 없습니다")
+ 
+     return template
+ 
+ 
+ @router.put("/{church_id}/templates/{template_id}", response_model=schemas.BulletinTemplate)
+ def update_template(
+     church_id: int,
+     template_id: int,
+     template_update: schemas.BulletinTemplateUpdate,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """템플릿 정보를 수정합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted is False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted is False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     # 템플릿 조회
+     template = db.query(BulletinTemplate).filter(
+         BulletinTemplate.id == template_id,
+         BulletinTemplate.church_id == church_id,
+         BulletinTemplate.is_deleted is False
+     ).first()
+ 
+     if template is None:
+         raise HTTPException(status_code=404, detail="템플릿을 찾을 수 없습니다")
+ 
+     # 템플릿 정보 업데이트
+     update_data = template_update.dict(exclude_unset=True)
+     for key, value in update_data.items():
+         setattr(template, key, value)
+ 
+     db.commit()
+     db.refresh(template)
+     return template
+ 
+ 
+ @router.delete("/{church_id}/templates/{template_id}")
+ def delete_template(
+     church_id: int,
+     template_id: int,
+     db: Session = Depends(get_db),
+     current_user: User = Depends(get_current_active_user)
+ ):
+     """템플릿을 삭제합니다."""
+     # 교회 조회
+     db_church = db.query(Church).filter(
+         Church.id == church_id,
+         Church.is_deleted is False
+     ).first()
+ 
+     if db_church is None:
+         raise HTTPException(status_code=404, detail="교회를 찾을 수 없습니다")
+ 
+     # 권한 확인
+     is_admin = db.query(ChurchAdmin).filter(
+         ChurchAdmin.church_id == church_id,
+         ChurchAdmin.user_id == current_user.id,
+         ChurchAdmin.is_deleted is False
+     ).first()
+ 
+     if not is_admin:
+         raise HTTPException(status_code=403, detail="접근 권한이 없습니다")
+ 
+     # 템플릿 조회
+     template = db.query(BulletinTemplate).filter(
+         BulletinTemplate.id == template_id,
+         BulletinTemplate.church_id == church_id,
+         BulletinTemplate.is_deleted is False
+     ).first()
+ 
+     if template is None:
+         raise HTTPException(status_code=404, detail="템플릿을 찾을 수 없습니다")
+ 
+     # 템플릿 삭제 처리 (소프트 삭제)
+     template.is_deleted = True
+     template.deleted_at = datetime.now()
+     db.commit()
+ 
+     return {"detail": "템플릿이 삭제되었습니다"}
```

---

_****_

이제 라우터를 메인 라우터에 등록하겠습니다.

---

_****_

```diff
  from app.routers.auth import router as auth_router
  from app.routers.users import router as users_router
+ from app.routers.churches import router as churches_router
+ from app.routers.bulletins import router as bulletins_router
+ from app.routers.templates import router as templates_router
  
  router = APIRouter()
  
  router.include_router(auth_router, prefix="/auth", tags=["auth"])
  router.include_router(users_router, prefix="/users", tags=["users"])
+ router.include_router(churches_router, prefix="/churches", tags=["churches"])
+ router.include_router(bulletins_router, prefix="/churches", tags=["bulletins"])
+ router.include_router(templates_router, prefix="/churches", tags=["templates"])
  
```

---

_****_

이제 모든 구현이 완료되었습니다. 서버를 재시작해야 변경사항이 적용됩니다.

## 구현 내용 요약

1. **교회 관리 기능**
   - 교회 목록 조회: 로그인한 사용자가 관리하는 교회 목록을 반환
   - 교회 생성: 교회 구분값(영문), 이름(필수), 주소, 연락처 정보 입력
   - 교회 구분값 중복 확인: 구분값 중복 여부 확인 API
   - 교회 상세 정보 조회: 특정 교회의 상세 정보 반환
   - 교회 정보 수정: 교회 이름, 주소, 연락처 정보 수정
   - 교회 삭제: 교회 정보 삭제 (소프트 삭제)

2. **주보 관리 기능**
   - 주보 목록 조회: 특정 교회의 주보 목록을 날짜 내림차순으로 반환
   - 주보 생성: 날짜, 내용, 템플릿 ID를 입력하여 주보 생성
   - 주보 상세 정보 조회: 특정 주보의 상세 정보 반환
   - 주보 정보 수정: 주보 날짜, 내용, 템플릿 수정
   - 주보 삭제: 주보 정보 삭제 (소프트 삭제)

3. **템플릿 관리 기능**
   - 템플릿 목록 조회: 특정 교회의 템플릿 목록 반환
   - 템플릿 생성: 템플릿 이름, 템플릿 데이터 입력하여 생성
   - 템플릿 상세 정보 조회: 특정 템플릿의 상세 정보 반환
   - 템플릿 정보 수정: 템플릿 이름, 템플릿 데이터 수정
   - 템플릿 삭제: 템플릿 정보 삭제 (소프트 삭제)

이 구현을 통해 사용자는 로그인 후 자신이 관리하는 교회 목록을 볼 수 있고, 새 교회를 생성하거나 기존 교회를 관리할 수 있습니다. 교회 페이지에서는 주보 목록을 확인하고 관리할 수 있으며, 템플릿을 통해 주보의 디자인을 관리할 수 있습니다.

---

_**User**_

이제 이 backend 내용과 frontend 코드를 연결하려고 해. 현재 frontend는 로그인하고 나면 / 이리로 이동하는데 이게 아니고 인증키가 있으면 교회 리스트 페이지로 이동하도록 하고 위의 내용들을 전달할 수 있는 프론트 페이지들을 만들어서 연결해줘.

---

_**Assistant**_

# 프론트엔드 구현 계획

백엔드와 프론트엔드를 연결하기 위해 필요한 페이지들을 구현하겠습니다. 먼저 프론트엔드 프로젝트 구조를 확인해 보겠습니다.

---

_****_

<details>
            <summary>Listed directory ../bulletin_frontend • **20** results</summary>
        
| Name |
|-------|
| 📁 `.git` |
| 📁 `.next` |
| 📄 `next.config.mjs` |
| 📄 `package-lock.json` |
| 📄 `package.json` |
| 📁 `node_modules` |
| 📁 `src` |
| 📁 `out` |
| 📁 `.specstory` |
| 📁 `scripts` |
| 📄 `.DS_Store` |
| 📄 `.cursorrules` |
| 📁 `.wrangler` |
| 📁 `public` |
| 📄 `components.json` |
| 📄 `jsconfig.json` |
| 📄 `.gitignore` |
| 📄 `README.md` |
| 📄 `eslint.config.mjs` |
| 📄 `postcss.config.mjs` |

</details>

---

_****_

<details>
            <summary>Listed directory ../bulletin_frontend/src • **5** results</summary>
        
| Name |
|-------|
| 📄 `middleware.js` |
| 📁 `app` |
| 📁 `lib` |
| 📄 `.DS_Store` |
| 📁 `components` |

</details>

---

_****_

<details>
            <summary>Listed directory ../bulletin_frontend/src/app • **7** results</summary>
        
| Name |
|-------|
| 📁 `forgot-password` |
| 📁 `register` |
| 📄 `layout.js` |
| 📁 `login` |
| 📄 `page.js` |
| 📄 `globals.css` |
| 📄 `favicon.ico` |

</details>

---

_****_

Read file: undefined

---

_****_

Read file: undefined

---

_****_

이제 필요한 페이지들을 구현하겠습니다. 먼저 교회 목록 페이지를 만들겠습니다.

---

_****_

```diff
  
  // 인증이 필요한 경로 목록
- const protectedRoutes = ['/'];
+ const protectedRoutes = ['/churches', '/bulletins', '/templates'];
  // 인증된 사용자가 접근할 수 없는 경로 목록 (로그인, 회원가입 등)
  const authRoutes = ['/login', '/register', '/forgot-password'];
  
    console.log('미들웨어 실행:', pathname, '인증 상태:', isAuthenticated);
+ 
+   // 루트 경로에 접근하는 경우 교회 목록 페이지로 리다이렉트
+   if (pathname === '/' && isAuthenticated) {
+     console.log('인증된 사용자가 루트 경로에 접근: 교회 목록으로 리다이렉트');
+     return NextResponse.redirect(new URL('/churches', request.url));
+   }
  
    // 인증이 필요한 경로에 인증되지 않은 사용자가 접근하는 경우
    if (authRoutes.some(route => pathname === route || pathname.startsWith(`${route}/`)) && isAuthenticated) {
      console.log('인증된 사용자가 인증 페이지에 접근:', pathname);
-     return NextResponse.redirect(new URL('/', request.url));
+     return NextResponse.redirect(new URL('/churches', request.url));
    }
  
```

---

_****_

이제 API 서비스를 구현하겠습니다.

---

_****_



---

_****_

```bash
cd ../bulletin_frontend && npm install axios
```

```
npm error code ERESOLVE
npm error ERESOLVE could not resolve
npm error
npm error While resolving: react-day-picker@8.10.1
npm error Found: react@19.0.0
npm error node_modules/react
npm error   peer react@">=16.8.0" from @floating-ui/react-dom@2.1.2
npm error   node_modules/@floating-ui/react-dom
npm error     @floating-ui/react-dom@"^2.0.0" from @radix-ui/react-popper@1.2.2
npm error     node_modules/@radix-ui/react-popper
npm error       @radix-ui/react-popper@"1.2.2" from @radix-ui/react-popover@1.1.
6
npm error       node_modules/@radix-ui/react-popover
npm error         @radix-ui/react-popover@"^1.1.6" from the root project
npm error   peer react@"^16.8 || ^17.0 || ^18.0 || ^19.0 || ^19.0.0-rc" from @ra
dix-ui/react-arrow@1.1.2
npm error   node_modules/@radix-ui/react-arrow
npm error     @radix-ui/react-arrow@"1.1.2" from @radix-ui/react-popper@1.2.2
npm error     node_modules/@radix-ui/react-popper
npm error       @radix-ui/react-popper@"1.2.2" from @radix-ui/react-popover@1.1.
6
npm error       node_modules/@radix-ui/react-popover
npm error         @radix-ui/react-popover@"^1.1.6" from the root project
npm error   35 more (@radix-ui/react-collection, ...)
npm error
npm error Could not resolve dependency:
npm error peer react@"^16.8.0 || ^17.0.0 || ^18.0.0" from react-day-picker@8.10.
1
npm error node_modules/react-day-picker
npm error   react-day-picker@"^8.10.1" from the root project
npm error
npm error Conflicting peer dependency: react@18.3.1
npm error node_modules/react
npm error   peer react@"^16.8.0 || ^17.0.0 || ^18.0.0" from react-day-picker@8.1
0.1
npm error   node_modules/react-day-picker
npm error     react-day-picker@"^8.10.1" from the root project
npm error
npm error Fix the upstream dependency conflict, or retry
npm error this command with --force or --legacy-peer-deps
npm error to accept an incorrect (and potentially broken) dependency resolution.
npm error
npm error
npm error For a full report see:
npm error /Users/emart/.npm/_logs/2025-03-13T06_39_37_218Z-eresolve-report.txt
npm error A complete log of this run can be found in: /Users/emart/.npm/_logs/20
25-03-13T06_39_37_218Z-de
bug-0.log
                         
```

---

_****_

```bash
cd ../bulletin_frontend && npm install axios --legacy-peer-deps
```

```
bulletin-backend-py3.11emart@minaraeui-MacBookPro bulletin_frontend % cd ../bulletin_frontend && npm inst
all axios --legacy-peer-deps                                          cd ../bulletin_frontend && npm inst
all axios --legacy-peer-deps

up to date, audited 365 packages in 688ms

135 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
bulletin-backend-py3.11emart@minaraeui-MacBookPro bulletin_frontend %
```

---

_****_

이제 교회 목록 페이지를 만들겠습니다.

---

_****_

```diff
- 
+ "use client";
+ 
+ import { useState, useEffect } from "react";
+ import { useRouter } from "next/navigation";
+ import Link from "next/link";
+ import { Plus, Edit, Trash2, Church, AlertCircle } from "lucide-react";
+ 
+ import { Button } from "@/components/ui/button";
+ import { Card, CardContent, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
+ import { Input } from "@/components/ui/input";
+ import {
+   Dialog,
+   DialogContent,
+   DialogDescription,
+   DialogFooter,
+   DialogHeader,
+   DialogTitle,
+   DialogTrigger,
+   DialogClose
+ } from "@/components/ui/dialog";
+ import {
+   AlertDialog,
+   AlertDialogAction,
+   AlertDialogCancel,
+   AlertDialogContent,
+   AlertDialogDescription,
+   AlertDialogFooter,
+   AlertDialogHeader,
+   AlertDialogTitle,
+   AlertDialogTrigger,
+ } from "@/components/ui/alert-dialog";
+ import { Label } from "@/components/ui/label";
+ import { useToast } from "@/components/ui/use-toast";
+ import { churchAPI } from "@/lib/api";
+ 
+ export default function ChurchesPage() {
+   const [churches, setChurches] = useState([]);
+   const [loading, setLoading] = useState(true);
+   const [searchTerm, setSearchTerm] = useState("");
+   const [newChurch, setNewChurch] = useState({
+     church_code: "",
+     name: "",
+     address: "",
+     contact_info: ""
+   });
+   const [codeAvailable, setCodeAvailable] = useState(null);
+   const [codeCheckMessage, setCodeCheckMessage] = useState("");
+   const [codeCheckLoading, setCodeCheckLoading] = useState(false);
+ 
+   const router = useRouter();
+   const { toast } = useToast();
+ 
+   // 교회 목록 불러오기
+   useEffect(() => {
+     const fetchChurches = async () => {
+       try {
+         setLoading(true);
+         const data = await churchAPI.getChurches();
+         setChurches(data);
+       } catch (error) {
+         console.error("교회 목록을 불러오는데 실패했습니다:", error);
+         toast({
+           title: "오류",
+           description: "교회 목록을 불러오는데 실패했습니다.",
+           variant: "destructive",
+         });
+       } finally {
+         setLoading(false);
+       }
+     };
+ 
+     fetchChurches();
+   }, [toast]);
+ 
+   // 교회 코드 중복 확인
+   const checkChurchCode = async () => {
+     if (!newChurch.church_code) {
+       setCodeAvailable(false);
+       setCodeCheckMessage("교회 구분값을 입력해주세요.");
+       return;
+     }
+ 
+     try {
+       setCodeCheckLoading(true);
+       const response = await churchAPI.checkChurchCode(newChurch.church_code);
+       setCodeAvailable(response.available);
+       setCodeCheckMessage(response.message);
+     } catch (error) {
+       console.error("교회 코드 확인 중 오류 발생:", error);
+       setCodeAvailable(false);
+       setCodeCheckMessage("교회 구분값 확인 중 오류가 발생했습니다.");
+     } finally {
+       setCodeCheckLoading(false);
+     }
+   };
+ 
+   // 교회 생성
+   const handleCreateChurch = async () => {
+     if (!newChurch.church_code || !newChurch.name) {
+       toast({
+         title: "입력 오류",
+         description: "교회 구분값과 이름은 필수 입력 항목입니다.",
+         variant: "destructive",
+       });
+       return;
+     }
+ 
+     if (codeAvailable !== true) {
+       toast({
+         title: "교회 구분값 오류",
+         description: "사용 가능한 교회 구분값인지 확인해주세요.",
+         variant: "destructive",
+       });
+       return;
+     }
+ 
+     try {
+       const createdChurch = await churchAPI.createChurch(newChurch);
+       setChurches([...churches, createdChurch]);
+       setNewChurch({
+         church_code: "",
+         name: "",
+         address: "",
+         contact_info: ""
+       });
+       setCodeAvailable(null);
+       setCodeCheckMessage("");
+ 
+       toast({
+         title: "교회 생성 완료",
+         description: "새 교회가 성공적으로 생성되었습니다.",
+       });
+     } catch (error) {
+       console.error("교회 생성 중 오류 발생:", error);
+       toast({
+         title: "교회 생성 실패",
+         description: error.response?.data?.detail || "교회 생성 중 오류가 발생했습니다.",
+         variant: "destructive",
+       });
+     }
+   };
+ 
+   // 교회 삭제
+   const handleDeleteChurch = async (id) => {
+     try {
+       await churchAPI.deleteChurch(id);
+       setChurches(churches.filter(church => church.id !== id));
+       toast({
+         title: "교회 삭제 완료",
+         description: "교회가 성공적으로 삭제되었습니다.",
+       });
+     } catch (error) {
+       console.error("교회 삭제 중 오류 발생:", error);
+       toast({
+         title: "교회 삭제 실패",
+         description: "교회 삭제 중 오류가 발생했습니다.",
+         variant: "destructive",
+       });
+     }
+   };
+ 
+   // 검색 필터링
+   const filteredChurches = churches.filter(church =>
+     church.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
+     church.church_code.toLowerCase().includes(searchTerm.toLowerCase())
+   );
+ 
+   return (
+     <div className="container mx-auto py-8">
+       <div className="flex justify-between items-center mb-6">
+         <h1 className="text-2xl font-bold">교회 관리</h1>
+         <Dialog>
+           <DialogTrigger asChild>
+             <Button>
+               <Plus className="mr-2 h-4 w-4" /> 교회 추가
+             </Button>
+           </DialogTrigger>
+           <DialogContent className="sm:max-w-[425px]">
+             <DialogHeader>
+               <DialogTitle>새 교회 추가</DialogTitle>
+               <DialogDescription>
+                 새로운 교회 정보를 입력해주세요. 교회 구분값과 이름은 필수 입력 항목입니다.
+               </DialogDescription>
+             </DialogHeader>
+             <div className="grid gap-4 py-4">
+               <div className="grid grid-cols-4 items-center gap-4">
+                 <Label htmlFor="church_code" className="text-right">
+                   교회 구분값*
+                 </Label>
+                 <div className="col-span-3 flex gap-2">
+                   <Input
+                     id="church_code"
+                     value={newChurch.church_code}
+                     onChange={(e) => {
+                       setNewChurch({ ...newChurch, church_code: e.target.value });
+                       setCodeAvailable(null);
+                       setCodeCheckMessage("");
+                     }}
+                     placeholder="영문, 숫자, 하이픈, 언더스코어만 사용 가능"
+                     className="flex-1"
+                   />
+                   <Button
+                     variant="outline"
+                     onClick={checkChurchCode}
+                     disabled={codeCheckLoading}
+                   >
+                     확인
+                   </Button>
+                 </div>
+               </div>
+               {codeCheckMessage && (
+                 <div className="grid grid-cols-4 items-center gap-4">
+                   <div></div>
+                   <div className={`col-span-3 text-sm ${codeAvailable ? 'text-green-600' : 'text-red-600'}`}>
+                     {codeCheckMessage}
+                   </div>
+                 </div>
+               )}
+               <div className="grid grid-cols-4 items-center gap-4">
+                 <Label htmlFor="name" className="text-right">
+                   교회 이름*
+                 </Label>
+                 <Input
+                   id="name"
+                   value={newChurch.name}
+                   onChange={(e) => setNewChurch({ ...newChurch, name: e.target.value })}
+                   className="col-span-3"
+                 />
+               </div>
+               <div className="grid grid-cols-4 items-center gap-4">
+                 <Label htmlFor="address" className="text-right">
+                   주소
+                 </Label>
+                 <Input
+                   id="address"
+                   value={newChurch.address}
+                   onChange={(e) => setNewChurch({ ...newChurch, address: e.target.value })}
+                   className="col-span-3"
+                 />
+               </div>
+               <div className="grid grid-cols-4 items-center gap-4">
+                 <Label htmlFor="contact_info" className="text-right">
+                   연락처
+                 </Label>
+                 <Input
+                   id="contact_info"
+                   value={newChurch.contact_info}
+                   onChange={(e) => setNewChurch({ ...newChurch, contact_info: e.target.value })}
+                   className="col-span-3"
+                 />
+               </div>
+             </div>
+             <DialogFooter>
+               <DialogClose asChild>
+                 <Button variant="outline">취소</Button>
+               </DialogClose>
+               <Button onClick={handleCreateChurch}>추가</Button>
+             </DialogFooter>
+           </DialogContent>
+         </Dialog>
+       </div>
+ 
+       <div className="mb-6">
+         <Input
+           placeholder="교회 이름 또는 구분값으로 검색"
+           value={searchTerm}
+           onChange={(e) => setSearchTerm(e.target.value)}
+           className="max-w-md"
+         />
+       </div>
+ 
+       {loading ? (
+         <div className="flex justify-center items-center h-64">
+           <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
+         </div>
+       ) : filteredChurches.length > 0 ? (
+         <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
+           {filteredChurches.map((church) => (
+             <Card key={church.id} className="overflow-hidden">
+               <CardHeader className="bg-gray-50">
+                 <CardTitle className="flex justify-between items-center">
+                   <span className="truncate">{church.name}</span>
+                   <span className="text-sm font-normal text-gray-500">{church.church_code}</span>
+                 </CardTitle>
+               </CardHeader>
+               <CardContent className="pt-6">
+                 <div className="space-y-2">
+                   {church.address && (
+                     <p className="text-sm text-gray-600">
+                       <span className="font-medium">주소:</span> {church.address}
+                     </p>
+                   )}
+                   {church.contact_info && (
+                     <p className="text-sm text-gray-600">
+                       <span className="font-medium">연락처:</span> {church.contact_info}
+                     </p>
+                   )}
+                 </div>
+               </CardContent>
+               <CardFooter className="flex justify-between border-t pt-4">
+                 <Button
+                   variant="outline"
+                   size="sm"
+                   onClick={() => router.push(`/churches/${church.id}`)}
+                 >
+                   <Church className="mr-2 h-4 w-4" /> 관리
+                 </Button>
+                 <div className="flex gap-2">
+                   <Button
+                     variant="outline"
+                     size="sm"
+                     onClick={() => router.push(`/churches/${church.id}/edit`)}
+                   >
+                     <Edit className="mr-2 h-4 w-4" /> 수정
+                   </Button>
+                   <AlertDialog>
+                     <AlertDialogTrigger asChild>
+                       <Button variant="destructive" size="sm">
+                         <Trash2 className="mr-2 h-4 w-4" /> 삭제
+                       </Button>
+                     </AlertDialogTrigger>
+                     <AlertDialogContent>
+                       <AlertDialogHeader>
+                         <AlertDialogTitle>교회 삭제</AlertDialogTitle>
+                         <AlertDialogDescription>
+                           정말로 "{church.name}" 교회를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.
+                         </AlertDialogDescription>
+                       </AlertDialogHeader>
+                       <AlertDialogFooter>
+                         <AlertDialogCancel>취소</AlertDialogCancel>
+                         <AlertDialogAction onClick={() => handleDeleteChurch(church.id)}>
+                           삭제
+                         </AlertDialogAction>
+                       </AlertDialogFooter>
+                     </AlertDialogContent>
+                   </AlertDialog>
+                 </div>
+               </CardFooter>
+             </Card>
+           ))}
+         </div>
+       ) : (
+         <div className="flex flex-col items-center justify-center h-64 bg-gray-50 rounded-lg border border-dashed border-gray-300">
+           <AlertCircle className="h-10 w-10 text-gray-400 mb-4" />
+           <h3 className="text-lg font-medium text-gray-900">교회가 없습니다</h3>
+           <p className="text-sm text-gray-500 mt-2 mb-4 text-center max-w-md">
+             {searchTerm
+               ? "검색 조건에 맞는 교회가 없습니다. 다른 검색어를 입력해보세요."
+               : "아직 등록된 교회가 없습니다. 새 교회를 추가해보세요."}
+           </p>
+           {!searchTerm && (
+             <Dialog>
+               <DialogTrigger asChild>
+                 <Button>
+                   <Plus className="mr-2 h-4 w-4" /> 교회 추가
+                 </Button>
+               </DialogTrigger>
+               <DialogContent className="sm:max-w-[425px]">
+                 {/* 교회 추가 다이얼로그 내용 (위와 동일) */}
+                 <DialogHeader>
+                   <DialogTitle>새 교회 추가</DialogTitle>
+                   <DialogDescription>
+                     새로운 교회 정보를 입력해주세요. 교회 구분값과 이름은 필수 입력 항목입니다.
+                   </DialogDescription>
+                 </DialogHeader>
+                 <div className="grid gap-4 py-4">
+                   <div className="grid grid-cols-4 items-center gap-4">
+                     <Label htmlFor="church_code_empty" className="text-right">
+                       교회 구분값*
+                     </Label>
+                     <div className="col-span-3 flex gap-2">
+                       <Input
+                         id="church_code_empty"
+                         value={newChurch.church_code}
+                         onChange={(e) => {
+                           setNewChurch({ ...newChurch, church_code: e.target.value });
+                           setCodeAvailable(null);
+                           setCodeCheckMessage("");
+                         }}
+                         placeholder="영문, 숫자, 하이픈, 언더스코어만 사용 가능"
+                         className="flex-1"
+                       />
+                       <Button
+                         variant="outline"
+                         onClick={checkChurchCode}
+                         disabled={codeCheckLoading}
+                       >
+                         확인
+                       </Button>
+                     </div>
+                   </div>
+                   {codeCheckMessage && (
+                     <div className="grid grid-cols-4 items-center gap-4">
+                       <div></div>
+                       <div className={`col-span-3 text-sm ${codeAvailable ? 'text-green-600' : 'text-red-600'}`}>
+                         {codeCheckMessage}
+                       </div>
+                     </div>
+                   )}
+                   <div className="grid grid-cols-4 items-center gap-4">
+                     <Label htmlFor="name_empty" className="text-right">
+                       교회 이름*
+                     </Label>
+                     <Input
+                       id="name_empty"
+                       value={newChurch.name}
+                       onChange={(e) => setNewChurch({ ...newChurch, name: e.target.value })}
+                       className="col-span-3"
+                     />
+                   </div>
+                   <div className="grid grid-cols-4 items-center gap-4">
+                     <Label htmlFor="address_empty" className="text-right">
+                       주소
+                     </Label>
+                     <Input
+                       id="address_empty"
+                       value={newChurch.address}
+                       onChange={(e) => setNewChurch({ ...newChurch, address: e.target.value })}
+                       className="col-span-3"
+                     />
+                   </div>
+                   <div className="grid grid-cols-4 items-center gap-4">
+                     <Label htmlFor="contact_info_empty" className="text-right">
+                       연락처
+                     </Label>
+                     <Input
+                       id="contact_info_empty"
+                       value={newChurch.contact_info}
+                       onChange={(e) => setNewChurch({ ...newChurch, contact_info: e.target.value })}
+                       className="col-span-3"
+                     />
+                   </div>
+                 </div>
+                 <DialogFooter>
+                   <DialogClose asChild>
+                     <Button variant="outline">취소</Button>
+                   </DialogClose>
+                   <Button onClick={handleCreateChurch}>추가</Button>
+                 </DialogFooter>
+               </DialogContent>
+             </Dialog>
+           )}
+         </div>
+       )}
+     </div>
+   );
+ }
```

---

_****_

이제 교회 상세 페이지를 만들겠습니다.

---

_****_

```diff
- 
+ "use client";
+ 
+ import { useState, useEffect } from "react";
+ import { useRouter } from "next/navigation";
+ import Link from "next/link";
+ import {
+   FileText,
+   Settings,
+   Layout,
+   ChevronRight,
+   Calendar,
+   Edit,
+   Trash2,
+   Plus,
+   ArrowLeft
+ } from "lucide-react";
+ 
+ import { Button } from "@/components/ui/button";
+ import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
+ import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
+ import { Separator } from "@/components/ui/separator";
+ import { useToast } from "@/components/ui/use-toast";
+ import { churchAPI, bulletinAPI, templateAPI } from "@/lib/api";
+ 
+ export default function ChurchDetailPage({ params }) {
+   const [church, setChurch] = useState(null);
+   const [bulletins, setBulletins] = useState([]);
+   const [templates, setTemplates] = useState([]);
+   const [loading, setLoading] = useState(true);
+   const [activeTab, setActiveTab] = useState("bulletins");
+ 
+   const router = useRouter();
+   const { toast } = useToast();
+   const churchId = params.id;
+ 
+   // 교회 정보 불러오기
+   useEffect(() => {
+     const fetchChurchData = async () => {
+       try {
+         setLoading(true);
+         const churchData = await churchAPI.getChurch(churchId);
+         setChurch(churchData);
+ 
+         // 주보 목록 불러오기
+         const bulletinsData = await bulletinAPI.getBulletins(churchId);
+         setBulletins(bulletinsData);
+ 
+         // 템플릿 목록 불러오기
+         const templatesData = await templateAPI.getTemplates(churchId);
+         setTemplates(templatesData);
+       } catch (error) {
+         console.error("교회 정보를 불러오는데 실패했습니다:", error);
+         toast({
+           title: "오류",
+           description: "교회 정보를 불러오는데 실패했습니다.",
+           variant: "destructive",
+         });
+         router.push("/churches");
+       } finally {
+         setLoading(false);
+       }
+     };
+ 
+     fetchChurchData();
+   }, [churchId, router, toast]);
+ 
+   // 날짜 포맷 함수
+   const formatDate = (dateString) => {
+     const date = new Date(dateString);
+     return date.toLocaleDateString('ko-KR', {
+       year: 'numeric',
+       month: 'long',
+       day: 'numeric',
+       weekday: 'long'
+     });
+   };
+ 
+   if (loading) {
+     return (
+       <div className="container mx-auto py-8">
+         <div className="flex justify-center items-center h-64">
+           <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
+         </div>
+       </div>
+     );
+   }
+ 
+   return (
+     <div className="container mx-auto py-8">
+       <div className="mb-6">
+         <Button
+           variant="ghost"
+           onClick={() => router.push("/churches")}
+           className="mb-4"
+         >
+           <ArrowLeft className="mr-2 h-4 w-4" /> 교회 목록으로 돌아가기
+         </Button>
+ 
+         <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
+           <div>
+             <h1 className="text-3xl font-bold">{church.name}</h1>
+             <p className="text-gray-500 mt-1">구분값: {church.church_code}</p>
+           </div>
+           <Button
+             variant="outline"
+             onClick={() => router.push(`/churches/${churchId}/edit`)}
+           >
+             <Settings className="mr-2 h-4 w-4" /> 교회 설정
+           </Button>
+         </div>
+ 
+         <Separator className="my-6" />
+       </div>
+ 
+       <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
+         <TabsList className="grid w-full grid-cols-3">
+           <TabsTrigger value="bulletins">
+             <FileText className="mr-2 h-4 w-4" /> 주보 관리
+           </TabsTrigger>
+           <TabsTrigger value="templates">
+             <Layout className="mr-2 h-4 w-4" /> 템플릿 관리
+           </TabsTrigger>
+           <TabsTrigger value="settings">
+             <Settings className="mr-2 h-4 w-4" /> 교회 정보
+           </TabsTrigger>
+         </TabsList>
+ 
+         {/* 주보 관리 탭 */}
+         <TabsContent value="bulletins" className="mt-6">
+           <div className="flex justify-between items-center mb-6">
+             <h2 className="text-xl font-semibold">주보 목록</h2>
+             <Button onClick={() => router.push(`/churches/${churchId}/bulletins/new`)}>
+               <Plus className="mr-2 h-4 w-4" /> 새 주보 작성
+             </Button>
+           </div>
+ 
+           {bulletins.length > 0 ? (
+             <div className="grid gap-4">
+               {bulletins.map((bulletin) => (
+                 <Card key={bulletin.id} className="overflow-hidden">
+                   <CardHeader className="pb-3">
+                     <CardTitle className="text-lg">{formatDate(bulletin.date)}</CardTitle>
+                   </CardHeader>
+                   <CardContent className="pb-3">
+                     <div className="flex justify-between items-center">
+                       <div className="flex items-center">
+                         <Calendar className="h-4 w-4 text-gray-500 mr-2" />
+                         <span className="text-sm text-gray-500">
+                           작성일: {new Date(bulletin.created_at).toLocaleDateString()}
+                         </span>
+                       </div>
+                       <div className="flex gap-2">
+                         <Button
+                           variant="outline"
+                           size="sm"
+                           onClick={() => router.push(`/churches/${churchId}/bulletins/${bulletin.id}/edit`)}
+                         >
+                           <Edit className="h-4 w-4" />
+                         </Button>
+                         <Button
+                           variant="destructive"
+                           size="sm"
+                           onClick={() => handleDeleteBulletin(bulletin.id)}
+                         >
+                           <Trash2 className="h-4 w-4" />
+                         </Button>
+                       </div>
+                     </div>
+                   </CardContent>
+                   <CardFooter>
+                     <Button
+                       variant="ghost"
+                       className="w-full justify-between"
+                       onClick={() => router.push(`/churches/${churchId}/bulletins/${bulletin.id}`)}
+                     >
+                       <span>주보 보기</span>
+                       <ChevronRight className="h-4 w-4" />
+                     </Button>
+                   </CardFooter>
+                 </Card>
+               ))}
+             </div>
+           ) : (
+             <Card>
+               <CardHeader>
+                 <CardTitle>주보가 없습니다</CardTitle>
+                 <CardDescription>
+                   아직 등록된 주보가 없습니다. 새 주보를 작성해보세요.
+                 </CardDescription>
+               </CardHeader>
+               <CardFooter>
+                 <Button
+                   onClick={() => router.push(`/churches/${churchId}/bulletins/new`)}
+                   className="w-full"
+                 >
+                   <Plus className="mr-2 h-4 w-4" /> 새 주보 작성
+                 </Button>
+               </CardFooter>
+             </Card>
+           )}
+         </TabsContent>
+ 
+         {/* 템플릿 관리 탭 */}
+         <TabsContent value="templates" className="mt-6">
+           <div className="flex justify-between items-center mb-6">
+             <h2 className="text-xl font-semibold">템플릿 목록</h2>
+             <Button onClick={() => router.push(`/churches/${churchId}/templates/new`)}>
+               <Plus className="mr-2 h-4 w-4" /> 새 템플릿 추가
+             </Button>
+           </div>
+ 
+           {templates.length > 0 ? (
+             <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
+               {templates.map((template) => (
+                 <Card key={template.id} className="overflow-hidden">
+                   <CardHeader>
+                     <CardTitle>{template.name}</CardTitle>
+                   </CardHeader>
+                   <CardContent>
+                     <div className="h-40 bg-gray-100 rounded-md flex items-center justify-center">
+                       <Layout className="h-10 w-10 text-gray-400" />
+                     </div>
+                   </CardContent>
+                   <CardFooter className="flex justify-between">
+                     <Button
+                       variant="outline"
+                       onClick={() => router.push(`/churches/${churchId}/templates/${template.id}`)}
+                     >
+                       미리보기
+                     </Button>
+                     <div className="flex gap-2">
+                       <Button
+                         variant="outline"
+                         size="icon"
+                         onClick={() => router.push(`/churches/${churchId}/templates/${template.id}/edit`)}
+                       >
+                         <Edit className="h-4 w-4" />
+                       </Button>
+                       <Button
+                         variant="destructive"
+                         size="icon"
+                         onClick={() => handleDeleteTemplate(template.id)}
+                       >
+                         <Trash2 className="h-4 w-4" />
+                       </Button>
+                     </div>
+                   </CardFooter>
+                 </Card>
+               ))}
+             </div>
+           ) : (
+             <Card>
+               <CardHeader>
+                 <CardTitle>템플릿이 없습니다</CardTitle>
+                 <CardDescription>
+                   아직 등록된 템플릿이 없습니다. 새 템플릿을 추가해보세요.
+                 </CardDescription>
+               </CardHeader>
+               <CardFooter>
+                 <Button
+                   onClick={() => router.push(`/churches/${churchId}/templates/new`)}
+                   className="w-full"
+                 >
+                   <Plus className="mr-2 h-4 w-4" /> 새 템플릿 추가
+                 </Button>
+               </CardFooter>
+             </Card>
+           )}
+         </TabsContent>
+ 
+         {/* 교회 정보 탭 */}
+         <TabsContent value="settings" className="mt-6">
+           <Card>
+             <CardHeader>
+               <CardTitle>교회 정보</CardTitle>
+               <CardDescription>
+                 교회의 기본 정보를 확인하고 관리할 수 있습니다.
+               </CardDescription>
+             </CardHeader>
+             <CardContent className="space-y-4">
+               <div>
+                 <h3 className="text-sm font-medium text-gray-500">교회 이름</h3>
+                 <p className="text-lg">{church.name}</p>
+               </div>
+               <div>
+                 <h3 className="text-sm font-medium text-gray-500">교회 구분값</h3>
+                 <p className="text-lg">{church.church_code}</p>
+               </div>
+               {church.address && (
+                 <div>
+                   <h3 className="text-sm font-medium text-gray-500">주소</h3>
+                   <p className="text-lg">{church.address}</p>
+                 </div>
+               )}
+               {church.contact_info && (
+                 <div>
+                   <h3 className="text-sm font-medium text-gray-500">연락처</h3>
+                   <p className="text-lg">{church.contact_info}</p>
+                 </div>
+               )}
+               <div>
+                 <h3 className="text-sm font-medium text-gray-500">생성일</h3>
+                 <p className="text-lg">{new Date(church.created_at).toLocaleDateString()}</p>
+               </div>
+             </CardContent>
+             <CardFooter className="flex justify-between">
+               <Button
+                 variant="outline"
+                 onClick={() => router.push(`/churches/${churchId}/edit`)}
+               >
+                 <Edit className="mr-2 h-4 w-4" /> 정보 수정
+               </Button>
+               <Button
+                 variant="destructive"
+                 onClick={() => {
+                   if (confirm("정말로 이 교회를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.")) {
+                     handleDeleteChurch();
+                   }
+                 }}
+               >
+                 <Trash2 className="mr-2 h-4 w-4" /> 교회 삭제
+               </Button>
+             </CardFooter>
+           </Card>
+         </TabsContent>
+       </Tabs>
+     </div>
+   );
+ 
+   // 교회 삭제 함수
+   async function handleDeleteChurch() {
+     try {
+       await churchAPI.deleteChurch(churchId);
+       toast({
+         title: "교회 삭제 완료",
+         description: "교회가 성공적으로 삭제되었습니다.",
+       });
+       router.push("/churches");
+     } catch (error) {
+       console.error("교회 삭제 중 오류 발생:", error);
+       toast({
+         title: "교회 삭제 실패",
+         description: "교회 삭제 중 오류가 발생했습니다.",
+         variant: "destructive",
+       });
+     }
+   }
+ 
+   // 주보 삭제 함수
+   async function handleDeleteBulletin(bulletinId) {
+     if (!confirm("정말로 이 주보를 삭제하시겠습니까?")) {
+       return;
+     }
+ 
+     try {
+       await bulletinAPI.deleteBulletin(churchId, bulletinId);
+       setBulletins(bulletins.filter(bulletin => bulletin.id !== bulletinId));
+       toast({
+         title: "주보 삭제 완료",
+         description: "주보가 성공적으로 삭제되었습니다.",
+       });
+     } catch (error) {
+       console.error("주보 삭제 중 오류 발생:", error);
+       toast({
+         title: "주보 삭제 실패",
+         description: "주보 삭제 중 오류가 발생했습니다.",
+         variant: "destructive",
+       });
+     }
+   }
+ 
+   // 템플릿 삭제 함수
+   async function handleDeleteTemplate(templateId) {
+     if (!confirm("정말로 이 템플릿을 삭제하시겠습니까?")) {
+       return;
+     }
+ 
+     try {
+       await templateAPI.deleteTemplate(churchId, templateId);
+       setTemplates(templates.filter(template => template.id !== templateId));
+       toast({
+         title: "템플릿 삭제 완료",
+         description: "템플릿이 성공적으로 삭제되었습니다.",
+       });
+     } catch (error) {
+       console.error("템플릿 삭제 중 오류 발생:", error);
+       toast({
+         title: "템플릿 삭제 실패",
+         description: "템플릿 삭제 중 오류가 발생했습니다.",
+         variant: "destructive",
+       });
+     }
+   }
+ }
```

---

_****_

이제 교회 수정 페이지를 만들겠습니다.

---

_****_

```diff
- 
+ "use client";
+ 
+ import { useState, useEffect } from "react";
+ import { useRouter } from "next/navigation";
+ import { ArrowLeft, Save } from "lucide-react";
+ 
+ import { Button } from "@/components/ui/button";
+ import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
+ import { Input } from "@/components/ui/input";
+ import { Label } from "@/components/ui/label";
+ import { Separator } from "@/components/ui/separator";
+ import { useToast } from "@/components/ui/use-toast";
+ import { churchAPI } from "@/lib/api";
+ 
+ export default function EditChurchPage({ params }) {
+   const [church, setChurch] = useState(null);
+   const [formData, setFormData] = useState({
+     name: "",
+     address: "",
+     contact_info: ""
+   });
+   const [loading, setLoading] = useState(true);
+   const [saving, setSaving] = useState(false);
+ 
+   const router = useRouter();
+   const { toast } = useToast();
+   const churchId = params.id;
+ 
+   // 교회 정보 불러오기
+   useEffect(() => {
+     const fetchChurch = async () => {
+       try {
+         setLoading(true);
+         const data = await churchAPI.getChurch(churchId);
+         setChurch(data);
+         setFormData({
+           name: data.name || "",
+           address: data.address || "",
+           contact_info: data.contact_info || ""
+         });
+       } catch (error) {
+         console.error("교회 정보를 불러오는데 실패했습니다:", error);
+         toast({
+           title: "오류",
+           description: "교회 정보를 불러오는데 실패했습니다.",
+           variant: "destructive",
+         });
+         router.push("/churches");
+       } finally {
+         setLoading(false);
+       }
+     };
+ 
+     fetchChurch();
+   }, [churchId, router, toast]);
+ 
+   // 입력 필드 변경 핸들러
+   const handleChange = (e) => {
+     const { name, value } = e.target;
+     setFormData(prev => ({
+       ...prev,
+       [name]: value
+     }));
+   };
+ 
+   // 폼 제출 핸들러
+   const handleSubmit = async (e) => {
+     e.preventDefault();
+ 
+     if (!formData.name) {
+       toast({
+         title: "입력 오류",
+         description: "교회 이름은 필수 입력 항목입니다.",
+         variant: "destructive",
+       });
+       return;
+     }
+ 
+     try {
+       setSaving(true);
+       await churchAPI.updateChurch(churchId, formData);
+       toast({
+         title: "교회 정보 수정 완료",
+         description: "교회 정보가 성공적으로 수정되었습니다.",
+       });
+       router.push(`/churches/${churchId}`);
+     } catch (error) {
+       console.error("교회 정보 수정 중 오류 발생:", error);
+       toast({
+         title: "교회 정보 수정 실패",
+         description: error.response?.data?.detail || "교회 정보 수정 중 오류가 발생했습니다.",
+         variant: "destructive",
+       });
+     } finally {
+       setSaving(false);
+     }
+   };
+ 
+   if (loading) {
+     return (
+       <div className="container mx-auto py-8">
+         <div className="flex justify-center items-center h-64">
+           <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"></div>
+         </div>
+       </div>
+     );
+   }
+ 
+   return (
+     <div className="container mx-auto py-8">
+       <div className="mb-6">
+         <Button
+           variant="ghost"
+           onClick={() => router.push(`/churches/${churchId}`)}
+           className="mb-4"
+         >
+           <ArrowLeft className="mr-2 h-4 w-4" /> 교회 상세 페이지로 돌아가기
+         </Button>
+ 
+         <h1 className="text-3xl font-bold">교회 정보 수정</h1>
+         <p className="text-gray-500 mt-1">구분값: {church.church_code}</p>
+ 
+         <Separator className="my-6" />
+       </div>
+ 
+       <Card>
+         <CardHeader>
+           <CardTitle>교회 정보 수정</CardTitle>
+           <CardDescription>
+             교회의 기본 정보를 수정할 수 있습니다. 교회 이름은 필수 입력 항목입니다.
+           </CardDescription>
+         </CardHeader>
+         <form onSubmit={handleSubmit}>
+           <CardContent className="space-y-4">
+             <div className="space-y-2">
+               <Label htmlFor="name">교회 이름*</Label>
+               <Input
+                 id="name"
+                 name="name"
+                 value={formData.name}
+                 onChange={handleChange}
+                 required
+               />
+             </div>
+             <div className="space-y-2">
+               <Label htmlFor="address">주소</Label>
+               <Input
+                 id="address"
+                 name="address"
+                 value={formData.address}
+                 onChange={handleChange}
+               />
+             </div>
+             <div className="space-y-2">
+               <Label htmlFor="contact_info">연락처</Label>
+               <Input
+                 id="contact_info"
+                 name="contact_info"
+                 value={formData.contact_info}
+                 onChange={handleChange}
+               />
+             </div>
+           </CardContent>
+           <CardFooter className="flex justify-between">
+             <Button
+               type="button"
+               variant="outline"
+               onClick={() => router.push(`/churches/${churchId}`)}
+             >
+               취소
+             </Button>
+             <Button type="submit" disabled={saving}>
+               {saving ? (
+                 <>
+                   <div className="mr-2 h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"></div>
+                   저장 중...
+                 </>
+               ) : (
+                 <>
+                   <Save className="mr-2 h-4 w-4" /> 저장
+                 </>
+               )}
+             </Button>
+           </CardFooter>
+         </form>
+       </Card>
+     </div>
+   );
+ }
```

---

_****_

이제 구현이 완료되었습니다. 프론트엔드와 백엔드가 연결되어 교회 관리 기능을 사용할 수 있게 되었습니다.

## 구현 내용 요약

1. **백엔드 API 연결**
   - axios를 사용하여 백엔드 API와 통신하는 서비스 함수 구현
   - 인증 토큰 관리 및 에러 처리 로직 추가

2. **라우팅 및 미들웨어**
   - 인증된 사용자가 루트 경로에 접근할 때 교회 목록 페이지로 리다이렉트
   - 보호된 경로에 대한 인증 확인 로직 구현

3. **교회 관리 페이지**
   - 교회 목록 페이지: 사용자가 관리하는 교회 목록 표시, 검색, 추가, 수정, 삭제 기능
   - 교회 상세 페이지: 교회 정보, 주보 목록, 템플릿 목록 탭으로 구성
   - 교회 수정 페이지: 교회 정보 수정 기능

4. **주보 및 템플릿 관리**
   - 주보 목록 표시 및 관리 기능
   - 템플릿 목록 표시 및 관리 기능

이제 사용자는 로그인 후 자신이 관리하는 교회 목록을 볼 수 있고, 새 교회를 생성하거나 기존 교회를 관리할 수 있습니다. 교회 페이지에서는 주보 목록을 확인하고 관리할 수 있으며, 템플릿을 통해 주보의 디자인을 관리할 수 있습니다.

서버를 재시작하면 변경사항이 적용됩니다.

---

_**User**_

이 컴포넌트는 찾을 수 없다는데

---

_**Assistant**_

오류 메시지를 확인해보니 `@/components/ui/use-toast` 

---



---

